nmis_R_scripts
==============

R scripts for NMIS. There are many R scripts within the folders here; they take data stored in `Dropbox` and transform them to other datasets also stored in `Dropbox`, the end products of which are consumed by the NMIS website. Dropbox is used as a light syncing utility for the data at the moment; the scripts can be easily modified to run on anything on the filesystem.

Running the scripts, etc.
===
We use `make` to run the pipeline. Type `make`, and the entire pipeline should run. A few special things:

 * We use a `paver`-based program to auto-generate the makefiles, which we put onto git. (Run `pip install Paver` to install paver first, if you want to use it.) To auto-generate a makefile at any point type `paver make_makefile` in the terminal. Makefiles are auto-generated by the `paver` script reading all the R scripts in this folder, seeing which files are read in and which files are written out, and creating a dependency graph.
 * `paver make` runs `paver make_makefile` and `make`. So this command re-generates the makefile, and then executes it.
 * `make test` runs a series of checks to make sure that the data we are outputting follow the invariants needed by the website that consumes them (as well as makes sure the data is correct). Tests are in development at the moment.
 * To get an overview of what the scripts do, you are also able to make a "dependency graph" of all the scripts in this folder. You will first need to install dependencies (`pip install pydot`, and downloadthe [GraphViz](http://www.graphviz.org/)). After that, you can run `paver make_dependency_graph`, which will output `dependency_graph.pdf` to this directory. We check this into git as well.

Style Guide for R code
====

Sourcing files
-----

We expect that you run code in this directory while being on the main (ie, nmis_R_scripts) folder. As a result, all `source` calls should be relative (example: `source("source_scripts/NMIS_Functions.R")` and all data reads should be absolute (example: `read.csv("~/Dropbox/Nigeria/Nigeria 661 Baseline Data Cleaning/in_process_data/nmis/data_774/Health_774_NMIS_Facility.csv")`).
